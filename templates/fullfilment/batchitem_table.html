{% extends 'base.html' %}
{% load static %}

{% block title %}BatchItem Table View{% endblock %}

{% block content %}
<div class="container-fluid mt-3">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h2 class="h3 mb-0">BatchItem Table View</h2>
      <p class="mb-0 text-muted">Semua data batchitem dalam format tabel</p>
    </div>
    <div class="d-flex align-items-center">
      <a href="{% url 'fullfilment_index' %}" class="btn btn-outline-secondary d-flex align-items-center">
        <i class="bi bi-arrow-left me-2"></i> Back to Fullfilment
      </a>
    </div>
  </div>

  <div class="card shadow-sm">
    <div class="card-header bg-primary text-white fw-bold d-flex justify-content-between align-items-center">
      <span>BatchItem Data ({{ total_items }} items)</span>
      <div>
        <input type="text" id="tableSearch" class="form-control form-control-sm" placeholder="Search..." style="width: 200px;">
      </div>
    </div>
    <div class="table-responsive" style="max-height: 800px; overflow-y: auto;">
      <table class="table table-hover table-striped align-middle" id="batchitemTable">
        <thead class="table-light sticky-top">
          <tr>
            <th>Batch Name</th>
            <th>SKU</th>
            <th>Barcode</th>
            <th>Nama Produk</th>
            <th>Variant</th>
            <th>Brand</th>
            <th>Rak</th>
            <th class="text-center">Jumlah</th>
            <th class="text-center">Ambil</th>
            <th class="text-center">Transfer</th>
            <th class="text-center">Terpakai</th>
            <th class="text-center">Status</th>
            <th class="text-center">Completed At</th>
            <th class="text-center">Completed By</th>
            <th class="text-center">I</th>
            <th class="text-center">II</th>
            <th class="text-center">III</th>
          </tr>
        </thead>
        <tbody>
          {% for item in table_data %}
          <tr>
            <td>
              <a href="{% url 'batchpicking' item.batch_name %}" class="text-primary fw-bold">
                {{ item.batch_name }}
              </a>
            </td>
            <td class="fw-semibold">{{ item.sku }}</td>
            <td class="text-primary">{{ item.barcode }}</td>
            <td>{{ item.nama_produk }}</td>
            <td class="text-info">{{ item.variant_produk|default_if_none:'' }}</td>
            <td class="text-secondary">{{ item.brand|default_if_none:'' }}</td>
            <td>
              {% if item.rak %}
                <span class="badge bg-light text-dark border">{{ item.rak }}</span>
              {% else %}
                -
              {% endif %}
            </td>
            <td class="text-end fw-bold">{{ item.jumlah }}</td>
            <td class="text-end fw-bold">{{ item.jumlah_ambil }}</td>
            <td class="text-end fw-bold">{{ item.jumlah_transfer|default:0 }}</td>
            <td class="text-end fw-bold">{{ item.jumlah_terpakai|default:0 }}</td>
            <td class="text-center">
              {% if item.status_ambil == 'pending' %}
                <span class="badge bg-light text-dark">Pending</span>
              {% elif item.status_ambil == 'completed' %}
                <span class="badge bg-success">Completed</span>
              {% elif item.status_ambil == 'partial' %}
                <span class="badge bg-warning text-dark">Partial</span>
              {% elif item.status_ambil == 'over_stock' %}
                <span class="badge bg-danger">Over Stock</span>
              {% else %}
                <span class="badge bg-secondary">{{ item.status_ambil }}</span>
              {% endif %}
            </td>
            <td class="text-center">
              {% if item.completed_at %}
                {{ item.completed_at|date:"d/m/Y H:i" }}
              {% else %}
                -
              {% endif %}
            </td>
            <td class="text-center">{{ item.completed_by|default_if_none:'-' }}</td>
            <td class="text-center">{% if item.count_one > 0 %}{{ item.count_one }}{% endif %}</td>
            <td class="text-center">{% if item.count_duo > 0 %}{{ item.count_duo }}{% endif %}</td>
            <td class="text-center">{% if item.count_tri > 0 %}{{ item.count_tri }}{% endif %}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="17" class="text-center py-5">
              <p class="mb-0 text-muted">Tidak ada data batchitem.</p>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <div class="card-footer bg-light">
      <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center mb-0">
          {% if page_obj.has_previous %}
            <li class="page-item"><a class="page-link" href="?page=1">&laquo; Awal</a></li>
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">Sebelumnya</a></li>
          {% endif %}

          <li class="page-item disabled">
            <a class="page-link" href="#" tabindex="-1" aria-disabled="True">Halaman {{ page_obj.number }} dari {{ page_obj.paginator.num_pages }}</a>
          </li>

          {% if page_obj.has_next %}
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">Selanjutnya</a></li>
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">Akhir &raquo;</a></li>
          {% endif %}
        </ul>
      </nav>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Search functionality
  const searchInput = document.getElementById('tableSearch');
  const table = document.getElementById('batchitemTable');
  const rows = table.querySelectorAll('tbody tr');

  searchInput.addEventListener('input', function() {
    const searchTerm = this.value.toLowerCase();
    
    rows.forEach(row => {
      const text = row.textContent.toLowerCase();
      if (text.includes(searchTerm)) {
        row.style.display = '';
      } else {
        row.style.display = 'none';
      }
    });
  });
});
</script>
{% endblock %} 