{% extends 'base.html' %}
{% block title %}Inbound List{% endblock %}
{% block content %}
<h2 class="text-center mb-4">Daftar Inbound</h2>
<div class="d-flex justify-content-center mb-4 gap-2">
    <button class="btn btn-secondary" id="importBtn" type="button">Impor Massal</button>
    <a href="{% url 'inventory:inbound_tambah' %}" class="btn btn-success">Tambah</a>
</div>
<div class="card shadow-sm mb-4">
    <div class="card-body">
        <table id="inbound-table" class="table table-bordered table-striped w-100">
            <thead class="table-primary">
                <tr>
                    <th>ID</th>
                    <th>Nomor Inbound</th>
                    <th>Tanggal</th>
                    <th>Keterangan</th>
                    <th>Aksi</th>
                </tr>
                <tr id="filter-row">
                    <th><input type="text" class="form-control form-control-sm" placeholder="Cari ID" /></th>
                    <th><input type="text" class="form-control form-control-sm" placeholder="Cari Nomor" /></th>
                    <th><input type="text" class="form-control form-control-sm" placeholder="Cari Tanggal" /></th>
                    <th><input type="text" class="form-control form-control-sm" placeholder="Cari Keterangan" /></th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
</div>
<!-- Modal Import Inbound -->
<div id="importModal" class="modal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Import Inbound (Excel/CSV)</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="importForm" method="post" enctype="multipart/form-data" action="{% url 'inventory:inbound_import_massal' %}">
          {% csrf_token %}
          <div class="mb-3">
            <label for="file" class="form-label">Upload File</label>
            <input type="file" name="file" class="form-control" accept=".csv,.xls,.xlsx" required>
            <div class="form-text">Hanya kolom <b>SKU</b> dan <b>Quantity</b> yang diperlukan.<br>Download template: <a href="/static/template_import_inbound.xlsx">template_import_inbound.xlsx</a></div>
          </div>
          <button type="submit" class="btn btn-primary">Upload</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
        </form>
        <div id="importLoading" class="text-center" style="display:none;">
          <div class="spinner-border text-primary" role="status"></div>
          <p>Mengimpor data, mohon tunggu...</p>
        </div>
        <p class="mt-3 text-muted">* File yang didukung: .csv, .xls, .xlsx<br>* Nomor inbound, tanggal, dan keterangan akan otomatis diisi.</p>
      </div>
    </div>
  </div>
</div>
{% endblock %}
{% block extra_script %}
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css" />
<script>
$(document).ready(function() {
    var table = $('#inbound-table').DataTable({
        serverSide: true,
        processing: true,
        ajax: {
            url: '/inventory/inbound/data/',
            type: 'GET',
            data: function(d) {
                $('#filter-row th').each(function(i) {
                    var input = $(this).find('input');
                    if (input.length) {
                        d['columns['+i+'][search][value]'] = input.val();
                    }
                });
            }
        },
        columns: [
            { data: 'id' },
            { data: 'nomor_inbound' },
            { data: 'tanggal' },
            { data: 'keterangan' },
            { data: 'aksi', orderable: false, searchable: false }
        ],
        orderCellsTop: true,
        fixedHeader: true,
        pageLength: 100,
        lengthMenu: [[100, 500, 1000, -1], ['100', '500', '1000', 'All']],
        dom: 'lfrtip',
        scrollX: true
    });
    // Per-column filter
    $('#filter-row th, #filter-row td').each(function(i) {
        var input = $(this).find('input');
        if (input.length) {
            input.on('keyup change clear', function() {
                table.column(i).search(this.value).draw();
            });
        }
    });
    // Modal import
    $('#importBtn').on('click', function() {
        var modal = new bootstrap.Modal(document.getElementById('importModal'));
        modal.show();
    });
    $('#importForm').on('submit', function() {
        $('#importLoading').show();
    });
});
</script>
{% endblock %}
